<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>霧の森 - Stage</title>
  <style>
    :root{
      --text: #f2f2f2;
      --panel: rgba(0,0,0,.70);
      --line: rgba(255,255,255,.18);
      --dim: 0.35; /* 発言してないキャラの暗さ */
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:#000; font-family:system-ui,sans-serif; color:var(--text); }

    .app{ position:relative; height:100%; overflow:hidden; }

    /* 背景 */
    .bg{
      position:absolute; inset:0;
      background: url("assets/bg_stage1.png") center / cover no-repeat;
      filter: brightness(.78) contrast(1.05);
      transform: scale(1.02);
    }

    /* キャラ表示（下に並べる） */
/* キャラ表示：右下固定・下端ぴったり */
.chars{
  position: absolute;
  right: 16px;
  bottom: 0;                 /* ← 下にピッタリ */
  display: flex;
  align-items: flex-end;     /* ← 切れ端防止の最重要ポイント */
  gap: 14px;
  pointer-events: none;
  z-index: 2;
}

/* キャラ画像 */
.char{
  height: min(46vh, 360px);  /* 高さ基準（ここでサイズ調整） */
  width: auto;
  object-fit: contain;

  opacity: var(--dim);
  filter: brightness(.75);
  transition: opacity .15s linear, filter .15s linear, transform .15s linear;
}

/* 発言中キャラ */
.char.active{
  opacity: 1;
  filter: none;
  transform: translateY(-2px);
}


    /* 会話ボックス */
    .dialog{
      position:absolute; left:0; right:0; bottom:0;
      background: var(--panel);
      border-top: 1px solid var(--line);
      padding: 12px 14px 14px;
      min-height: 120px;
    }
    .toprow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .speaker{ font-weight:700; letter-spacing:.06em; }
    .hint{ font-size:.85rem; opacity:.75; }

    .text{
      line-height:1.85;
      white-space: pre-wrap;
      min-height: 3.6em;
      user-select:none;
    }

    .controls{
      margin-top: 10px;
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
    }
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 999px;
      padding: 9px 12px;
      cursor:pointer;
    }
    button:hover{ background: rgba(255,255,255,.10); }

    /* 画面タップで進める用（邪魔しない透明レイヤー） */
    .tapLayer{
      position:absolute; inset:0;
      background: transparent;
    }
    .fade{
  position:absolute;
  inset:0;
  background:#000;
  opacity: 1;
  transition: opacity 900ms ease;
  z-index: 999; /* 一番上 */
  pointer-events:none;
}
.fade.out{
  opacity: 0;
}
.char.hidden{
  opacity: 0 !important;
  visibility: hidden;
  transform: translateY(6px);
}
/* ===== トーン（言葉の強さ） ===== */
.dialog.tone-whisper .text { opacity: .72; }
.dialog.tone-whisper .speaker { opacity: .8; }

.dialog.tone-shout .text { font-size: 1.12em; letter-spacing: .03em; }
.dialog.tone-shout .speaker { filter: brightness(1.1); }

.dialog.tone-cold .text { opacity: .88; }
.dialog.tone-cold .text { text-shadow: 0 0 10px rgba(255,255,255,.12); }

/* ===== FX（視覚エフェクト） ===== */
@keyframes shakeTiny {
  0% { transform: translate(0,0); }
  25% { transform: translate(1px,0); }
  50% { transform: translate(-1px,1px); }
  75% { transform: translate(0,-1px); }
  100% { transform: translate(0,0); }
}
.dialog.fx-shake .text {
  animation: shakeTiny .12s infinite;
}

.dialog.fx-glitch .text{
  text-shadow:
    1px 0 rgba(255,0,0,.25),
   -1px 0 rgba(0,200,255,.20),
    0 0 10px rgba(255,255,255,.12);
}

  </style>
</head>

<body>
  <div class="app">
    <div id="fade" class="fade" aria-hidden="true"></div>

    <div id="bg" class="bg" aria-hidden="true"></div>

    <!-- キャラ（画像差し替えOK） -->
<div class="chars" aria-hidden="true">
  <img id="char_atsushi" class="char hidden" src="assets/char_atsushi.png" alt="">
  <img id="char_shusuke" class="char hidden" src="assets/char_shusuke.png" alt="">
  <img id="char_fanako" class="char hidden" src="assets/char_fanako.png" alt="">
</div>

<audio id="bgm" src="assets/stage1_bgm.mp3" loop></audio>



    <!-- 会話 -->
    <section id="dialog" class="dialog" aria-label="会話">

      <div class="toprow">
        <div id="speaker" class="speaker">—</div>
        
      </div>

      <div id="text" class="text"></div>

      

    </section>

    <!-- 画面タップで進める -->
    <div id="tapLayer" class="tapLayer" aria-hidden="true"></div>
  </div>

  <!-- ステージ1を読み込む -->
  <script type="module" src="stage1.js"></script>
</body>
</html>








